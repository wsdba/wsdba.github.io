<!DOCTYPE html><head><title>Convert Const to Let by Terser - kkocdko's blog</title><meta name="description" content="Using TreeTransformer"><script src="/bundle.js" onload="[].flat||(location='/update.html')"></script></head><main><article><h1>Convert Const to Let by Terser</h1><blockquote><p><a href="https://github.com/terser-js/terser">Terser</a> is a JavaScript optimizer for ES6+.</p></blockquote><h2 id="why">Why</h2><p><code>const</code> is a keyword to define a unchangeable thing, it can make code stronger. But if you use <code>const</code>, Terser will not convert it to <code>let</code>. This <strong>wastes more than two chars</strong>:</p><p>Source:</p><pre><code class="language-javascript">const a = 1
let b = 2
const c = 3</code></pre><p>Terser output:</p><pre><code class="language-javascript">const a=1;let b=2;const c=3; // 28 chars</code></pre><p>If Terser convert <code>const</code> to <code>let</code>:</p><pre><code class="language-javascript">let a=1,b=2,c=3; // 16 chars</code></pre><p>But Terser&#39;s major contributors <a href="https://github.com/terser-js/terser/issues/172">refuse to implement this feature</a>. Certainly, it&#39;s unsafe, but who will try to change a constant?</p><h2 id="solution">Solution</h2><pre><code class="language-javascript">const Terser = require(&quot;terser&quot;);
const jsStr = &quot;const a = 0;&quot;;
const transformer = new Terser.TreeTransformer((node) =&gt; {
  if (node instanceof Terser.AST_Const) {
    return new Terser.AST_Let(node);
  }
});
const ast = Terser.parse(jsStr).transform(transformer);
const minifiedJsStr = Terser.minify(ast).code;
constle.log(minifiedJsStr); // =&gt; &quot;let a=0;&quot;</code></pre><ul><li>Want to know more? See <a href="https://github.com/terser-js/terser#working-with-terser-ast">https://github.com/terser-js/terser#working-with-terser-ast</a></li></ul></article></main>